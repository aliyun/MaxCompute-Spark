ç”±äºå®‰å…¨åŸå› ï¼Œç”¨æˆ·æ— æ³•è§¦è¾¾ç”Ÿäº§é›†ç¾¤çš„ç½‘ç»œï¼Œæ‰€ä»¥MaxCompute Sparkä¸€ç›´æ²¡æœ‰æ”¾å¼€ `yarn-client`çš„æ”¯æŒï¼Œä¹Ÿå°±æ˜¯`Spark-Shell`ï¼Œ`Spark-SQL`ä»¥åŠ`PYSPARK`ç­‰äº¤äº’å¼åŠŸèƒ½ä¸€ç›´æ— æ³•æ”¯æŒã€‚Zeppelin on MaxCompute Sparkå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ”¯æŒç”¨æˆ·äº¤äº’å¼éœ€æ±‚ã€‚è¿™ä¸ªæ¨¡å¼ç›¸å¯¹äºlocalæ¨¡å¼æ›´æœ‰åŠ›çš„åœ°æ–¹æ˜¯ï¼Œè¿™ä¸ªæ¨¡å¼å…¶å®æ˜¯çœŸå®ç”¨äº†yarn-clusteræ¨¡å¼è¿è¡Œç€çš„ï¼Œlocalæ¨¡å¼ä»…ä»…èƒ½éªŒè¯è¯­æ³•æ˜¯å¦æ­£ç¡®ï¼Œè€Œzeppelinæ¨¡å¼èƒ½ä»¥åˆ†å¸ƒå¼çš„æ–¹å¼æä¾›äº¤äº’å¼æŸ¥è¯¢ï¼Œè¿™ä¸ªå¯¹äºé‚£ç§éœ€è¦å…³æ³¨æ€§èƒ½ç»“æœçš„debuggingæ˜¯æœ‰å¸®åŠ©çš„ã€‚

##  æ­¥éª¤è¯´æ˜

*  ä¸€é”®å¯åŠ¨è„šæœ¬ï¼š
    * spark 2.3 è§ [spark-zeppelin-public.sh](https://odps-repo.oss-cn-hangzhou.aliyuncs.com/spark-zeppelin-public/spark-zeppelin-public.sh)
    * spark 2.4 è§ [spark-zeppelin-public-2.4.sh](https://odps-repo.oss-cn-hangzhou.aliyuncs.com/spark-zeppelin-public/spark-zeppelin-public-2.4.sh)
* ä¸‹è½½è„šæœ¬åˆ°æœ¬åœ°åï¼Œè¿è¡Œ `sh spark-zeppelin-public.sh` åï¼Œä¼šè‡ªåŠ¨ä¸‹è½½ç›¸å…³ç»„ä»¶å¦‚ä¸‹
    * spark-zeppelin-public.conf
    * spark-zeppelin-public.jar
    * spark-2.3.0-odps0.32.1.tar.gz
* ç¬¬ä¸€æ¬¡è¿è¡Œè„šæœ¬ä¼šå‡ºç°ä»¥ä¸‹é”™è¯¯ï¼Œè¿™æ˜¯å› ä¸ºé»˜è®¤çš„`spark-zeppelin-public.conf`å¹¶æ²¡æœ‰é…ç½®accessIdï¼ŒaccessKeyï¼ŒprojectName

```
linxuewei:spark-zeppelin-public linxuewei$ sh spark-zeppelin-public.sh 
working dir: /Users/linxuewei/Desktop/spark-zeppelin-public
download spark-zeppelin-public.conf
download spark-zeppelin-public.jar
download spark-2.3.0-odps0.32.1.tar.gz
extract spark-2.3.0-odps0.32.1.tar.gz
export SPARK_HOME
spark-zeppelin-public.conf checking
TBD count is        3, plz check config make sure id key project is written!
config check failed, plz set id key project in spark-zeppelin-public.conf
```

* æ³¨æ„Spark 2.4.5éœ€è¦æ·»åŠ  `spark.sql.catalogImplementation = hive å’Œ spark.sql.sources.default = hive` ä¹‹åå†è¿è¡Œ `sh spark-zeppelin-public.sh` 
* Spark 2.4.5æ·»åŠ  `spark.hadoop.odps.spark.libs.public.enable=true`å’Œ`spark.hadoop.odps.spark.version=spark-2.4.5-odps0.33.1` è¿™ä¸¤ä¸ªå‚æ•°å¯ä»¥åŠ é€ŸåŒ…ä¸Šä¼ é€Ÿåº¦

* æ­£å¸¸é…ç½® `spark-zeppelin-public.conf` ä¹‹åå†è¿è¡Œ `sh spark-zeppelin-public.sh` 

```
linxuewei:spark-zeppelin-public linxuewei$ sh spark-zeppelin-public.sh 
working dir: /Users/linxuewei/Desktop/spark-zeppelin-public
export SPARK_HOME
spark-zeppelin-public.conf checking
config check passed, start spark-submit

å°±ä¼šå¯åŠ¨ä¸€ä¸ªMaxCompute Sparkä½œä¸šï¼Œç­‰å¾…ä½œä¸šæ‰§è¡Œç»“æŸä¹‹åï¼Œå¯ä»¥å›æº¯æ—¥å¿—ï¼Œæ‰¾åˆ°logview

http://logview.odps.aliyun.com/logview/?h=http://service.cn.maxcompute.aliyun.com/api&p=zky_test&i=20190710044052214gy6kc292&token=eXN6eFlsNmQzOFV4dUIzVEVndm9KQUtVSlVNPSxPRFBTX09CTzpwNF8yNDcwNjM5MjQ1NDg0NDc5NzksMTU2Mjk5Mjg1Mix7IlN0YXRlbWVudCI6W3siQWN0aW9uIjpbIm9kcHM6UmVhZCJdLCJFZmZlY3QiOiJBbGxvdyIsIlJlc291cmNlIjpbImFjczpvZHBzOio6cHJvamVjdHMvemt5X3Rlc3QvaW5zdGFuY2VzLzIwMTkwNzEwMDQ0MDUyMjE0Z3k2a2MyOTIiXX1dLCJWZXJzaW9uIjoiMSJ9
```

* æ‰“å¼€ `logview` ç‚¹å‡» `master-0` ç‚¹å‡» `StdOut`

 ![image.png](https://ata2-img.cn-hangzhou.oss-pub.aliyun-inc.com/425b961b2b3074622b41068e9a78409f.png)

```
# æ—¥å¿—ä¸­çš„è¿™ä¸ªurlï¼Œå°±æ˜¯zeppelin serverçš„åœ°å€äº†
# ç›´æ¥å¤åˆ¶ç²˜è´´åˆ°æµè§ˆå™¨ä¸Šå³å¯è®¿é—®ï¼Œå¼¹å‡ºçš„urlä¼šéœ€è¦äº‘è´¦å·çš„ç™»å½•
Please visit the following url for zeppelin interaction.
http://20190710044052214gy6kc292-zeppelin.open.maxcompute.aliyun.com
Log dir doesn't exist, create /worker/zeppelin_logs/
Pid dir doesn't exist, create /worker/zeppelin_pids/
Zeppelin start [60G[[0;32m  OK  [0;39m]
```

* æ‰“å¼€ `zeppelin url` æ‰“å¼€ `Examples` Notebookï¼Œæœ‰æ—¶å€™é¡µé¢ä¼šæ˜¾ç¤ºendpoint not existçš„æ—¥å¿—ï¼Œè¿™æ˜¯å› ä¸ºzeppelinè¿˜æ²¡æœ‰å¯åŠ¨å®Œæ¯•çš„æƒ…å†µï¼Œç¨ç­‰ç‰‡åˆ»å°±å¯ä»¥

![image.png](https://ata2-img.cn-hangzhou.oss-pub.aliyun-inc.com/9f3c2496ba6f0d1cb827e5a6b81ee44a.png)

* å¦‚æœé¡µé¢å¼¹å‡ºä¸€ä¸ª `interpreter binding`çš„é¡µé¢ï¼Œç›´æ¥ç‚¹å‡»Saveå³å¯ï¼Œç„¶åå†ç‚¹å‡»ToolBarä¸Šçš„è¿è¡Œæ‰€æœ‰æŒ‰é’®å³å¯æ‰§è¡ŒNotebookä¸Šçš„ä»£ç çš„æ‰§è¡Œ

![image.png](https://ata2-img.cn-hangzhou.oss-pub.aliyun-inc.com/b9b8404f9bcd49e9464074e9860c2272.png)

* ä» examples æ ·ä¾‹ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒNoteBookæ”¯æŒä¸‰ç§è¯­æ³•
    * ä»¥ `%spark` å¼€å¤´è¡¨ç¤º scala æ‰§è¡Œå™¨ å¦‚æœä¸å†™å°±é»˜è®¤æ˜¯è¿™ä¸ªæ¨¡å¼
    * ä»¥ `%sql` å¼€å¤´è¡¨ç¤º spark-sql æ‰§è¡Œå™¨ï¼Œé»˜è®¤ç”¨ODPS External Catalog
    * ä»¥ `pyspark` å¼€å¤´è¡¨ç¤º pyspark æ‰§è¡Œå™¨ï¼Œé»˜è®¤ç”¨æˆ‘ä»¬æ‰“åŒ…å¥½çš„ python2.7

## èµ„æºé‡Šæ”¾

æœ¬è´¨ä¸ŠZeppelin Server on MaxCompute Sparkè¿˜æ˜¯ä¸€ä¸ªSparkä½œä¸šï¼Œé»˜è®¤è¿™ä¸ªä½œä¸šä¼šå­˜æ´»ä¸‰å¤©ï¼Œå¦‚æœä½ æƒ³æ‰‹åŠ¨å…³é—­è¿™ä¸ªä½œä¸šçš„è¯ï¼Œå°±è¯·ç”¨odpscmdï¼Œç”¨`kill <instanceId>;` å‘½ä»¤æ¥åœæ­¢ä½œä¸šé‡Šæ”¾èµ„æºå§ã€‚